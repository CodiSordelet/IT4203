<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Google Books Search</title>
    <link rel="stylesheet" href="./search.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
</head>

<body>
    <div class="banner">
      <form action="../">
        <button class="homeButton" >Home</button>
      </form>

        <h1 id="page-text">Milestone 4</h1>


        <div id="searchInputBox">
            <input id="searchInput" type="text" name="search" value="" click="search()" placeholder="Enter keywords">
            <button onclick="search()" id="searchclick" type="buttton">Search</button>
        </div>
        <button class="purty" type="button" name="bookshelfactivator" id="createBookShelfbutton" onclick="viewMyBookShelf()">View My Bookshelf</button>
    </div>



    <div class="buttonBox">
        <button class="purty pager" id="page1" type="button" onclick="changeResultsPage(1)">1</button>
        <button class="purty pager" id="page2" type="button" onclick="changeResultsPage(2)">2</button>
        <button class="purty pager" id="page3" type="button" onclick="changeResultsPage(3)">3</button>
        <button class="purty pager" id="page4" type="button" onclick="changeResultsPage(4)">4</button>
        <button class="purty pager" id="page5" type="button" onclick="changeResultsPage(5)">5</button>
        <button class="purty" id="displayChanger1" type="button" name="button" onclick="displayToggle(1)">List</button>
        <button class="purty" id="displayChanger2" type="button" name="button" onclick="displayToggle(2)">Grid</button>

    </div>

    <div class="container">
        <div id="booksContainer">

        </div>
        <div class="bookShelf">

        </div>
    </div>


    <script id="bookshelfTemplate" type="text/template">
        {{#items}}
        <div class=" grid bookdiv {{action}}">
            <a data-tog="{{divId}}" href="{{volumeInfo.infoLink}}"><h6 class="head">{{volumeInfo.title}}</h6></a>
            <a href="{{volumeInfo.infoLink}}"><img data-tog="{{divId}}" src="{{volumeInfo.imageLinks.smallThumbnail}}"></a>
            <div style="overflow:auto">
                <div data-tog="{{divId}}" id "={{id}}" class="details">
                    <p>Authors: {{volumeInfo.authors}}</p>
                    <p>Page Count:{{volumeInfo.pageCount}}</p>
                    <p>Price: {{price}}</p>
                    <p>Publisher: {{volumeInfo.publisher}}</p>
                    <p>Description: {{volumeInfo.description}}</p>
                    <p>Categories: {{volumeInfo.categories}}</p>
                </div>
                <button data-trigger="view-more" data-index="{{divId}}" id="{{divId}}" aria-hidden="true">View More</button>
            </div>
        </div>
        {{/items}}
    </script>



    <script id="template" type="text/template">
        {{#items}}
        <div class=" grid bookdiv {{action}}">
            <a data-tog="{{divId}}" href="{{volumeInfo.infoLink}}"><h6 class="head">{{volumeInfo.title}}</h6></a>
            <a href="{{volumeInfo.infoLink}}"><img data-tog="{{divId}}" src="{{volumeInfo.imageLinks.smallThumbnail}}"></a>
            <div style="overflow:auto">
                <div data-tog="{{divId}}" id "={{id}}" class="details">
                    <p>Authors: {{volumeInfo.authors}}</p>
                    <p>Page Count:{{volumeInfo.pageCount}}</p>
                    <p>Price: {{price}}</p>
                    <p>Publisher: {{volumeInfo.publisher}}</p>
                    <p>Description: {{volumeInfo.description}}</p>
                    <p>Categories: {{volumeInfo.categories}}</p>
                </div>
                <button data-trigger="view-more" data-index="{{divId}}" id="{{divId}}" aria-hidden="true">View More</button>
            </div>
        </div>
        {{/items}}
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
    <script type="text/javascript">
        var lastSearch;
        var boolean = true;
        var input = function() {
            var val;
            val = $("#searchInput").val();

            if (val) {
                lastSearch = val;
                return val;
            } else {
                return lastSearch
            }


        }


        var getBooks = function(url, templated) {
            var template;
            $.getJSON(url, function(data) {
                for (var i = 0; i < data.items.length; i++) {
                    if (data.items[i].saleInfo && data.items[i].saleInfo.saleability == "NOT_FOR_SALE") {
                        data.items[i]["price"] = "not for sale";
                    } else if (data.items[i].saleInfo) {
                        if (data.items[i].saleInfo.listPrice) {
                            if (data.items[i].saleInfo.listPrice.amount) {
                                data.items[i]["price"] = "$" + data.items[i].saleInfo["listPrice"]["amount"];
                            }
                        }
                    }
                }
                var books = data;
                for (var i = 0; i < books.items.length; i++) {
                    books.items[i]["divId"] = i;
                }
                if (templated) {
                    template = $(templated).html();

                } else {
                    template = $("#template").html();
                }

                Mustache.parse(template);
                var html = Mustache.render(template, books);
                $("#booksContainer").html(html);
            });
        };


        function search(urlEnding) {
            var val = input();
            let url = "https://www.googleapis.com/books/v1/volumes?q=search+";
            let urlInput;

            if (!urlEnding) {
                urlInput = url + val + "&startIndex=0&maxResults=10";
            } else {
                urlInput = url + val + urlEnding;
            }
            getBooks(urlInput);
            displayCurrentPage();

        }

        var rememberedvalue;

        function changeResultsPage(page) {
            let url = "https://www.googleapis.com/books/v1/volumes?q=";
            let urlInput;
            $("#booksContainer").empty();




            switch (page) {
                case 1:
                    search("&startIndex=0&maxResults=10");
                    break;
                case 2:
                    search("&startIndex=10&maxResults=10");
                    break;
                case 3:
                    search("&startIndex=20&maxResults=10");
                    break;
                case 4:
                    search("&startIndex=30&maxResults=10");
                    break;
                case 5:
                    search("&startIndex=40&maxResults=10");
                    break;
                default:
                    console.log("out of range");

            }

            if (rememberedvalue === 1) {
                displayToggle(1)
            } else if (rememberedvalue === 2) {
                displayToggle(2)

            }

            displayCurrentPage(page);


        }

        function displayCurrentPage(value) {
            if (!value) {
                value = 1;
            }
            switch (value) {
                case 1:
                    $(".purty#page1").css("background-color", "#5889a0")
                    break;
                case 2:
                    $(".purty#page2").css("background-color", "#5889a0")
                    break;
                case 3:
                    $(".purty#page3").css("background-color", "#5889a0")
                    break;
                case 4:
                    $(".purty#page4").css("background-color", "#5889a0")
                    break;
                case 5:
                    $(".purty#page5").css("background-color", "#5889a0")
                    break;

                case "mybookshelf":
                    $("#createBookShelfbutton").css("background-color", "#5889a0");

                    break;
                default:
                    console.log("out of range");


            }

            if (value != 2 && value != 3 && value != 4 && value != 5 && value != "mybookshelf") {
                $("#page2").css("background-color", "#A799A8")
                $("#page3").css("background-color", "#A799A8")
                $("#page4").css("background-color", "#A799A8")
                $("#page5").css("background-color", "#A799A8")
                $("#createBookShelfbutton").css("background-color", "#A799A8")
            } else if (value != 3 && value != 4 && value != 5 && value != 1 && value != "mybookshelf") {
                $("#page1").css("background-color", "#A799A8")
                $("#page3").css("background-color", "#A799A8")
                $("#page4").css("background-color", "#A799A8")
                $("#page5").css("background-color", "#A799A8")
                $("#createBookShelfbutton").css("background-color", "#A799A8")
            } else if (value != 1 && value != 2 && value != 4 && value != 5 && value != "mybookshelf") {
                $("#page1").css("background-color", "#A799A8")
                $("#page2").css("background-color", "#A799A8")
                $("#page4").css("background-color", "#A799A8")
                $("#page5").css("background-color", "#A799A8")
                $("#createBookShelfbutton").css("background-color", "#A799A8")
            } else if (value != 1 && value != 2 && value != 3 && value != 5 && value != "mybookshelf") {
                $("#page1").css("background-color", "#A799A8")
                $("#page2").css("background-color", "#A799A8")
                $("#page3").css("background-color", "#A799A8")
                $("#page5").css("background-color", "#A799A8")
                $("#createBookShelfbutton").css("background-color", "#A799A8")
            } else if (value != 1 && value != 2 && value != 3 && value != 4 && value != "mybookshelf") {
                $("#page1").css("background-color", "#A799A8")
                $("#page2").css("background-color", "#A799A8")
                $("#page3").css("background-color", "#A799A8")
                $("#page4").css("background-color", "#A799A8")
                $("#createBookShelfbutton").css("background-color", "#A799A8")
            } else if (value != 1 && value != 2 && value != 3 && value != 4 && value != 5) {
                $("#page1").css("background-color", "#A799A8")
                $("#page2").css("background-color", "#A799A8")
                $("#page3").css("background-color", "#A799A8")
                $("#page4").css("background-color", "#A799A8")
                $("#page5").css("background-color", "#A799A8")
            }
        }




        function displayToggle(value) {
            rememberedvalue = value;
            if (rememberedvalue === 1) {
                $(".bookdiv").css("width", "99%").css("height", "auto").css("padding", "0em");




            } else if (rememberedvalue === 2) {
                $(".bookdiv").css("width", "24%").css("height", "400px").css("padding", "0em");

            }
        }

        function viewMyBookShelf() {
            displayCurrentPage("mybookshelf");
            let link = "https://www.googleapis.com/books/v1/users/114745723588033378738/bookshelves/0/volumes";
            getBooks(link, "#bookshelfTemplate");



        }
        $("#searchInput").keypress(function(e) {
            if (e.which == 13) {
                search();
            }
        });







        $(document).ready(function() {

            $(document).on('click', '[data-trigger="view-more"]', function(evt) {
                var index = $(this).data("index");

                $('[data-tog=' + index + ']').toggle();
                $('img[data-tog=' + index + ']').hide();
                $('a[data-tog=' + index + ']').hide();
                var dataIndex = $('[data-index=' + index + ']');
                var temp = $('div').find(dataIndex);
                if (temp[0].innerHTML === 'View More') {
                    temp[0].innerHTML = 'Close';
                } else if (temp[0].innerHTML === 'Close') {
                    temp[0].innerHTML = 'View More';
                    $('img[data-tog=' + index + ']').show();
                    $('a[data-tog=' + index + ']').show();
                }
            });



        });
    </script>
</body>

</html>
